{"version":3,"sources":["../../../src/modules/cost-calculation/cost-calculation.integration.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { CostCalculationService } from './cost-calculation.service';\nimport { MaterialsService } from '../materials/materials.service';\nimport { PricingService } from '../pricing/pricing.service';\nimport { PricingLookupService } from '../../common/utils/pricing-lookup.service';\nimport { PrismaService } from '../../prisma/prisma.service';\nimport { ComponentData } from '../../common/interfaces';\nimport {\n  simpleDoorComponent,\n  drawerComponent,\n  cncComponent,\n  shelfComponent,\n  testComponentSet,\n} from '../../test/fixtures/test-components.fixture';\n\n/**\n * Integration tests for complete cost calculation flow\n * Tests the full pipeline from component data to final price\n */\ndescribe('Cost Calculation Integration Tests', () => {\n  let calculationService: CostCalculationService;\n  let materialsService: MaterialsService;\n  let pricingService: PricingService;\n  let pricingLookupService: PricingLookupService;\n\n  beforeEach(async () => {\n    // Mock PrismaService with realistic data\n    const mockPrismaService = {\n      material: {\n        findUnique: jest.fn((args) => {\n          const materials: any = {\n            'MAT-1': {\n              code: 'MAT-1',\n              description: 'ام دی اف 16 میل - سفید',\n              unit: 'متر مربع',\n              unitPrice: 22000000,\n              category: 'Panel',\n              persianNames: ['ام دی اف'],\n              isActive: true,\n            },\n          };\n          return Promise.resolve(materials[args.where.code] || null);\n        }),\n        findFirst: jest.fn(() =>\n          Promise.resolve({\n            code: 'MAT-1',\n            description: 'ام دی اف 16 میل - سفید',\n            unit: 'متر مربع',\n            unitPrice: 22000000,\n            category: 'Panel',\n            persianNames: ['ام دی اف'],\n            isActive: true,\n            id: '1',\n            createdAt: new Date(),\n            updatedAt: new Date(),\n          })\n        ),\n        findMany: jest.fn(() =>\n          Promise.resolve([\n            {\n              code: 'MAT-1',\n              description: 'ام دی اف 16 میل - سفید',\n              unit: 'متر مربع',\n              unitPrice: 22000000,\n              category: 'Panel',\n              persianNames: ['ام دی اف'],\n              isActive: true,\n              id: '1',\n              createdAt: new Date(),\n              updatedAt: new Date(),\n            },\n          ])\n        ),\n      },\n      edgeBanding: {\n        findUnique: jest.fn(() =>\n          Promise.resolve({\n            code: 'EB-1',\n            description: 'نوار کاری',\n            unit: 'متر',\n            unitPrice: 85000,\n            isActive: true,\n            id: '1',\n            createdAt: new Date(),\n            updatedAt: new Date(),\n          })\n        ),\n      },\n      cNCOperation: {\n        findUnique: jest.fn(() =>\n          Promise.resolve({\n            code: 'CNC-1',\n            description: 'CNC - درب کابینت',\n            unit: 'عدد',\n            unitPrice: 500000,\n            isActive: true,\n            id: '1',\n            createdAt: new Date(),\n            updatedAt: new Date(),\n          })\n        ),\n      },\n      fitting: {\n        findUnique: jest.fn(() => Promise.resolve(null)),\n        findFirst: jest.fn(() => Promise.resolve(null)),\n      },\n      pricingConfig: {\n        findFirst: jest.fn(() => Promise.resolve(null)), // Use defaults\n      },\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        CostCalculationService,\n        MaterialsService,\n        PricingService,\n        PricingLookupService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n      ],\n    }).compile();\n\n    calculationService = module.get<CostCalculationService>(CostCalculationService);\n    materialsService = module.get<MaterialsService>(MaterialsService);\n    pricingService = module.get<PricingService>(PricingService);\n    pricingLookupService = module.get<PricingLookupService>(PricingLookupService);\n  });\n\n  describe('Full Calculation Flow', () => {\n    it('should calculate complete cost for simple door project', async () => {\n      const components: ComponentData[] = [simpleDoorComponent];\n\n      const result = await calculationService.calculateFullCost(components, {\n        projectName: 'Kitchen Cabinets',\n        clientName: 'John Doe',\n        contractDate: '2025-01-15',\n        wastePercentage: 0.15,\n      });\n\n      // Verify result structure\n      expect(result).toBeDefined();\n      expect(result.project).toBeDefined();\n      expect(result.project.name).toBe('Kitchen Cabinets');\n      expect(result.project.client).toBe('John Doe');\n\n      // Verify all cost categories exist\n      expect(result.costs.material).toBeDefined();\n      expect(result.costs.boreshKari).toBeDefined();\n      expect(result.costs.cnc).toBeDefined();\n      expect(result.costs.navarShiar).toBeDefined();\n      expect(result.costs.fittings).toBeDefined();\n      expect(result.costs.painting).toBeDefined();\n      expect(result.costs.plate).toBeDefined();\n      expect(result.costs.woodTools).toBeDefined();\n\n      // Material costs should be positive\n      expect(result.costs.material.totalCost).toBeGreaterThan(0);\n\n      // Fittings costs should be positive (doors have hinges)\n      expect(result.costs.fittings.totalCost).toBeGreaterThan(0);\n\n      // WoodTools should have at least base cost\n      expect(result.costs.woodTools.totalCost).toBeGreaterThanOrEqual(500000);\n\n      // Financial summary\n      expect(result.financialSummary).toBeDefined();\n      expect(result.financialSummary.subtotal).toBeGreaterThan(0);\n      expect(result.financialSummary.finalPrice).toBeGreaterThan(result.financialSummary.subtotal);\n\n      // Verify overhead calculations\n      const expectedOverheadTotal =\n        result.financialSummary.subtotal * (0.25 + 0.04 + 0.02 + 0.02 + 0.025);\n      expect(result.financialSummary.overheads.totalOverheads).toBeCloseTo(\n        expectedOverheadTotal,\n        -3\n      );\n\n      // Verify profit calculation (22%)\n      const expectedProfit = result.financialSummary.totalWithOverheads * 0.22;\n      expect(result.financialSummary.profitAmount).toBeCloseTo(expectedProfit, -3);\n    });\n\n    it('should calculate costs for complex project with multiple component types', async () => {\n      const components: ComponentData[] = [\n        simpleDoorComponent,\n        drawerComponent,\n        cncComponent,\n        shelfComponent,\n      ];\n\n      const result = await calculationService.calculateFullCost(components, {\n        projectName: 'Full Kitchen',\n        clientName: 'Jane Smith',\n        contractDate: '2025-02-01',\n        wastePercentage: 0.15,\n      });\n\n      // Material costs should account for all components\n      expect(result.costs.material.totalCost).toBeGreaterThan(0);\n      expect(result.costs.material.totalArea).toBeGreaterThan(0);\n\n      // CNC costs should be present\n      expect(result.costs.cnc.totalCost).toBeGreaterThan(0);\n\n      // Fittings should include hinges, drawer rails, and handles\n      expect(result.costs.fittings.totalCost).toBeGreaterThan(0);\n      expect(result.costs.fittings.items.length).toBeGreaterThan(0);\n\n      // Edge banding costs for components with edges\n      expect(result.costs.navarShiar.totalCost).toBeGreaterThan(0);\n\n      // WoodTools should account for CNC complexity\n      expect(result.costs.woodTools.totalCost).toBeGreaterThan(500000);\n\n      // Final price should be reasonable\n      expect(result.financialSummary.finalPrice).toBeGreaterThan(\n        result.financialSummary.subtotal\n      );\n    });\n\n    it('should handle project with only shelves (minimal fittings)', async () => {\n      const components: ComponentData[] = [shelfComponent, shelfComponent];\n\n      const result = await calculationService.calculateFullCost(components, {\n        projectName: 'Shelving Unit',\n        clientName: 'Bob Builder',\n        contractDate: '2025-03-01',\n        wastePercentage: 0.10,\n      });\n\n      // Material costs present\n      expect(result.costs.material.totalCost).toBeGreaterThan(0);\n\n      // CNC costs should be zero (no CNC components)\n      expect(result.costs.cnc.totalCost).toBe(0);\n\n      // Fittings might be minimal or zero\n      // (shelves may not need fittings depending on heuristics)\n\n      // WoodTools should still have base cost\n      expect(result.costs.woodTools.totalCost).toBeGreaterThanOrEqual(500000);\n    });\n\n    it('should properly apply waste percentage', async () => {\n      const components: ComponentData[] = [simpleDoorComponent];\n\n      // Calculate with 0% waste\n      const resultNoWaste = await calculationService.calculateFullCost(components, {\n        projectName: 'Test',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0,\n      });\n\n      // Calculate with 20% waste\n      const resultWithWaste = await calculationService.calculateFullCost(components, {\n        projectName: 'Test',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0.20,\n      });\n\n      // Material cost with waste should be higher (but waste not directly applied to final in this implementation)\n      // The waste is applied during processing of components\n      expect(resultWithWaste.costs.material.totalCost).toBeGreaterThanOrEqual(\n        resultNoWaste.costs.material.totalCost\n      );\n    });\n  });\n\n  describe('Cost Breakdown Validation', () => {\n    it('should have valid cost breakdown structure', async () => {\n      const result = await calculationService.calculateFullCost([simpleDoorComponent], {\n        projectName: 'Test',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0.15,\n      });\n\n      // Verify breakdown matches subtotal\n      const breakdownSum =\n        result.financialSummary.breakdown.material +\n        result.financialSummary.breakdown.boreshKari +\n        result.financialSummary.breakdown.cnc +\n        result.financialSummary.breakdown.navarShiar +\n        result.financialSummary.breakdown.fittings +\n        result.financialSummary.breakdown.painting +\n        result.financialSummary.breakdown.plate +\n        result.financialSummary.breakdown.woodTools;\n\n      expect(breakdownSum).toBe(result.financialSummary.subtotal);\n    });\n\n    it('should calculate overheads as percentages of subtotal', async () => {\n      const result = await calculationService.calculateFullCost([simpleDoorComponent], {\n        projectName: 'Test',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0.15,\n      });\n\n      const subtotal = result.financialSummary.subtotal;\n\n      expect(result.financialSummary.overheads.overhead1).toBeCloseTo(\n        subtotal * 0.25,\n        -2\n      );\n      expect(result.financialSummary.overheads.overhead2).toBeCloseTo(\n        subtotal * 0.04,\n        -2\n      );\n      expect(result.financialSummary.overheads.overhead3).toBeCloseTo(\n        subtotal * 0.02,\n        -2\n      );\n      expect(result.financialSummary.overheads.overhead4).toBeCloseTo(\n        subtotal * 0.02,\n        -2\n      );\n      expect(result.financialSummary.overheads.contingency).toBeCloseTo(\n        subtotal * 0.025,\n        -2\n      );\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle empty component list', async () => {\n      const result = await calculationService.calculateFullCost([], {\n        projectName: 'Empty Project',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0.15,\n      });\n\n      expect(result.costs.material.totalCost).toBe(0);\n      expect(result.financialSummary.subtotal).toBeGreaterThanOrEqual(0);\n      // Still should have base woodtools cost\n      expect(result.costs.woodTools.totalCost).toBeGreaterThanOrEqual(500000);\n    });\n\n    it('should handle components with zero quantity', async () => {\n      const zeroQuantityComponent: ComponentData = {\n        ...simpleDoorComponent,\n        quantity: 0,\n        area: 0, // Zero area with zero quantity\n      };\n\n      const result = await calculationService.calculateFullCost(\n        [zeroQuantityComponent],\n        {\n          projectName: 'Zero Quantity Test',\n          clientName: 'Test',\n          contractDate: '2025-01-01',\n          wastePercentage: 0.15,\n        }\n      );\n\n      // Should handle gracefully without errors\n      expect(result).toBeDefined();\n      // With zero area and quantity, material cost should be zero or very low\n      expect(result.costs.material.totalCost).toBeLessThanOrEqual(100);\n    });\n\n    it('should handle very large projects', async () => {\n      // Create a large project with 100 components\n      const largeProject: ComponentData[] = Array(100)\n        .fill(null)\n        .map((_, index) => ({\n          ...simpleDoorComponent,\n          componentId: `CD-${index}`,\n          quantity: 1,\n        }));\n\n      const result = await calculationService.calculateFullCost(largeProject, {\n        projectName: 'Large Project',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0.15,\n      });\n\n      expect(result).toBeDefined();\n      expect(result.costs.material.totalCost).toBeGreaterThan(0);\n      expect(result.financialSummary.finalPrice).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Timestamp and Metadata', () => {\n    it('should include calculation timestamp', async () => {\n      const result = await calculationService.calculateFullCost([simpleDoorComponent], {\n        projectName: 'Test',\n        clientName: 'Test',\n        contractDate: '2025-01-01',\n        wastePercentage: 0.15,\n      });\n\n      expect(result.calculatedAt).toBeInstanceOf(Date);\n      expect(result.version).toBeDefined();\n    });\n\n    it('should preserve project metadata', async () => {\n      const projectData = {\n        projectName: 'Custom Kitchen Remodel',\n        clientName: 'Alice Wonderland',\n        contractDate: '2025-06-15',\n        wastePercentage: 0.18,\n      };\n\n      const result = await calculationService.calculateFullCost(\n        [simpleDoorComponent],\n        projectData\n      );\n\n      expect(result.project.name).toBe(projectData.projectName);\n      expect(result.project.client).toBe(projectData.clientName);\n      expect(result.project.date).toBe(projectData.contractDate);\n    });\n  });\n});\n\n"],"names":["describe","calculationService","materialsService","pricingService","pricingLookupService","beforeEach","mockPrismaService","material","findUnique","jest","fn","args","materials","code","description","unit","unitPrice","category","persianNames","isActive","Promise","resolve","where","findFirst","id","createdAt","Date","updatedAt","findMany","edgeBanding","cNCOperation","fitting","pricingConfig","module","Test","createTestingModule","providers","CostCalculationService","MaterialsService","PricingService","PricingLookupService","provide","PrismaService","useValue","compile","get","it","components","simpleDoorComponent","result","calculateFullCost","projectName","clientName","contractDate","wastePercentage","expect","toBeDefined","project","name","toBe","client","costs","boreshKari","cnc","navarShiar","fittings","painting","plate","woodTools","totalCost","toBeGreaterThan","toBeGreaterThanOrEqual","financialSummary","subtotal","finalPrice","expectedOverheadTotal","overheads","totalOverheads","toBeCloseTo","expectedProfit","totalWithOverheads","profitAmount","drawerComponent","cncComponent","shelfComponent","totalArea","items","length","resultNoWaste","resultWithWaste","breakdownSum","breakdown","overhead1","overhead2","overhead3","overhead4","contingency","zeroQuantityComponent","quantity","area","toBeLessThanOrEqual","largeProject","Array","fill","map","_","index","componentId","calculatedAt","toBeInstanceOf","version","projectData","date"],"mappings":";;;;yBAAoC;wCACG;kCACN;gCACF;sCACM;+BACP;uCAQvB;AAEP;;;CAGC,GACDA,SAAS,sCAAsC;IAC7C,IAAIC;IACJ,IAAIC;IACJ,IAAIC;IACJ,IAAIC;IAEJC,WAAW;QACT,yCAAyC;QACzC,MAAMC,oBAAoB;YACxBC,UAAU;gBACRC,YAAYC,KAAKC,EAAE,CAAC,CAACC;oBACnB,MAAMC,YAAiB;wBACrB,SAAS;4BACPC,MAAM;4BACNC,aAAa;4BACbC,MAAM;4BACNC,WAAW;4BACXC,UAAU;4BACVC,cAAc;gCAAC;6BAAW;4BAC1BC,UAAU;wBACZ;oBACF;oBACA,OAAOC,QAAQC,OAAO,CAACT,SAAS,CAACD,KAAKW,KAAK,CAACT,IAAI,CAAC,IAAI;gBACvD;gBACAU,WAAWd,KAAKC,EAAE,CAAC,IACjBU,QAAQC,OAAO,CAAC;wBACdR,MAAM;wBACNC,aAAa;wBACbC,MAAM;wBACNC,WAAW;wBACXC,UAAU;wBACVC,cAAc;4BAAC;yBAAW;wBAC1BC,UAAU;wBACVK,IAAI;wBACJC,WAAW,IAAIC;wBACfC,WAAW,IAAID;oBACjB;gBAEFE,UAAUnB,KAAKC,EAAE,CAAC,IAChBU,QAAQC,OAAO,CAAC;wBACd;4BACER,MAAM;4BACNC,aAAa;4BACbC,MAAM;4BACNC,WAAW;4BACXC,UAAU;4BACVC,cAAc;gCAAC;6BAAW;4BAC1BC,UAAU;4BACVK,IAAI;4BACJC,WAAW,IAAIC;4BACfC,WAAW,IAAID;wBACjB;qBACD;YAEL;YACAG,aAAa;gBACXrB,YAAYC,KAAKC,EAAE,CAAC,IAClBU,QAAQC,OAAO,CAAC;wBACdR,MAAM;wBACNC,aAAa;wBACbC,MAAM;wBACNC,WAAW;wBACXG,UAAU;wBACVK,IAAI;wBACJC,WAAW,IAAIC;wBACfC,WAAW,IAAID;oBACjB;YAEJ;YACAI,cAAc;gBACZtB,YAAYC,KAAKC,EAAE,CAAC,IAClBU,QAAQC,OAAO,CAAC;wBACdR,MAAM;wBACNC,aAAa;wBACbC,MAAM;wBACNC,WAAW;wBACXG,UAAU;wBACVK,IAAI;wBACJC,WAAW,IAAIC;wBACfC,WAAW,IAAID;oBACjB;YAEJ;YACAK,SAAS;gBACPvB,YAAYC,KAAKC,EAAE,CAAC,IAAMU,QAAQC,OAAO,CAAC;gBAC1CE,WAAWd,KAAKC,EAAE,CAAC,IAAMU,QAAQC,OAAO,CAAC;YAC3C;YACAW,eAAe;gBACbT,WAAWd,KAAKC,EAAE,CAAC,IAAMU,QAAQC,OAAO,CAAC;YAC3C;QACF;QAEA,MAAMY,SAAwB,MAAMC,aAAI,CAACC,mBAAmB,CAAC;YAC3DC,WAAW;gBACTC,8CAAsB;gBACtBC,kCAAgB;gBAChBC,8BAAc;gBACdC,0CAAoB;gBACpB;oBACEC,SAASC,4BAAa;oBACtBC,UAAUrC;gBACZ;aACD;QACH,GAAGsC,OAAO;QAEV3C,qBAAqBgC,OAAOY,GAAG,CAAyBR,8CAAsB;QAC9EnC,mBAAmB+B,OAAOY,GAAG,CAAmBP,kCAAgB;QAChEnC,iBAAiB8B,OAAOY,GAAG,CAAiBN,8BAAc;QAC1DnC,uBAAuB6B,OAAOY,GAAG,CAAuBL,0CAAoB;IAC9E;IAEAxC,SAAS,yBAAyB;QAChC8C,GAAG,0DAA0D;YAC3D,MAAMC,aAA8B;gBAACC,0CAAmB;aAAC;YAEzD,MAAMC,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAACH,YAAY;gBACpEI,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,0BAA0B;YAC1BC,OAAON,QAAQO,WAAW;YAC1BD,OAAON,OAAOQ,OAAO,EAAED,WAAW;YAClCD,OAAON,OAAOQ,OAAO,CAACC,IAAI,EAAEC,IAAI,CAAC;YACjCJ,OAAON,OAAOQ,OAAO,CAACG,MAAM,EAAED,IAAI,CAAC;YAEnC,mCAAmC;YACnCJ,OAAON,OAAOY,KAAK,CAACtD,QAAQ,EAAEiD,WAAW;YACzCD,OAAON,OAAOY,KAAK,CAACC,UAAU,EAAEN,WAAW;YAC3CD,OAAON,OAAOY,KAAK,CAACE,GAAG,EAAEP,WAAW;YACpCD,OAAON,OAAOY,KAAK,CAACG,UAAU,EAAER,WAAW;YAC3CD,OAAON,OAAOY,KAAK,CAACI,QAAQ,EAAET,WAAW;YACzCD,OAAON,OAAOY,KAAK,CAACK,QAAQ,EAAEV,WAAW;YACzCD,OAAON,OAAOY,KAAK,CAACM,KAAK,EAAEX,WAAW;YACtCD,OAAON,OAAOY,KAAK,CAACO,SAAS,EAAEZ,WAAW;YAE1C,oCAAoC;YACpCD,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAEC,eAAe,CAAC;YAExD,wDAAwD;YACxDf,OAAON,OAAOY,KAAK,CAACI,QAAQ,CAACI,SAAS,EAAEC,eAAe,CAAC;YAExD,2CAA2C;YAC3Cf,OAAON,OAAOY,KAAK,CAACO,SAAS,CAACC,SAAS,EAAEE,sBAAsB,CAAC;YAEhE,oBAAoB;YACpBhB,OAAON,OAAOuB,gBAAgB,EAAEhB,WAAW;YAC3CD,OAAON,OAAOuB,gBAAgB,CAACC,QAAQ,EAAEH,eAAe,CAAC;YACzDf,OAAON,OAAOuB,gBAAgB,CAACE,UAAU,EAAEJ,eAAe,CAACrB,OAAOuB,gBAAgB,CAACC,QAAQ;YAE3F,+BAA+B;YAC/B,MAAME,wBACJ1B,OAAOuB,gBAAgB,CAACC,QAAQ,GAAI,CAAA,OAAO,OAAO,OAAO,OAAO,KAAI;YACtElB,OAAON,OAAOuB,gBAAgB,CAACI,SAAS,CAACC,cAAc,EAAEC,WAAW,CAClEH,uBACA,CAAC;YAGH,kCAAkC;YAClC,MAAMI,iBAAiB9B,OAAOuB,gBAAgB,CAACQ,kBAAkB,GAAG;YACpEzB,OAAON,OAAOuB,gBAAgB,CAACS,YAAY,EAAEH,WAAW,CAACC,gBAAgB,CAAC;QAC5E;QAEAjC,GAAG,4EAA4E;YAC7E,MAAMC,aAA8B;gBAClCC,0CAAmB;gBACnBkC,sCAAe;gBACfC,mCAAY;gBACZC,qCAAc;aACf;YAED,MAAMnC,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAACH,YAAY;gBACpEI,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,mDAAmD;YACnDC,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAEC,eAAe,CAAC;YACxDf,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8E,SAAS,EAAEf,eAAe,CAAC;YAExD,8BAA8B;YAC9Bf,OAAON,OAAOY,KAAK,CAACE,GAAG,CAACM,SAAS,EAAEC,eAAe,CAAC;YAEnD,4DAA4D;YAC5Df,OAAON,OAAOY,KAAK,CAACI,QAAQ,CAACI,SAAS,EAAEC,eAAe,CAAC;YACxDf,OAAON,OAAOY,KAAK,CAACI,QAAQ,CAACqB,KAAK,CAACC,MAAM,EAAEjB,eAAe,CAAC;YAE3D,+CAA+C;YAC/Cf,OAAON,OAAOY,KAAK,CAACG,UAAU,CAACK,SAAS,EAAEC,eAAe,CAAC;YAE1D,8CAA8C;YAC9Cf,OAAON,OAAOY,KAAK,CAACO,SAAS,CAACC,SAAS,EAAEC,eAAe,CAAC;YAEzD,mCAAmC;YACnCf,OAAON,OAAOuB,gBAAgB,CAACE,UAAU,EAAEJ,eAAe,CACxDrB,OAAOuB,gBAAgB,CAACC,QAAQ;QAEpC;QAEA3B,GAAG,8DAA8D;YAC/D,MAAMC,aAA8B;gBAACqC,qCAAc;gBAAEA,qCAAc;aAAC;YAEpE,MAAMnC,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAACH,YAAY;gBACpEI,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,yBAAyB;YACzBC,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAEC,eAAe,CAAC;YAExD,+CAA+C;YAC/Cf,OAAON,OAAOY,KAAK,CAACE,GAAG,CAACM,SAAS,EAAEV,IAAI,CAAC;YAExC,oCAAoC;YACpC,0DAA0D;YAE1D,wCAAwC;YACxCJ,OAAON,OAAOY,KAAK,CAACO,SAAS,CAACC,SAAS,EAAEE,sBAAsB,CAAC;QAClE;QAEAzB,GAAG,0CAA0C;YAC3C,MAAMC,aAA8B;gBAACC,0CAAmB;aAAC;YAEzD,0BAA0B;YAC1B,MAAMwC,gBAAgB,MAAMvF,mBAAmBiD,iBAAiB,CAACH,YAAY;gBAC3EI,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,2BAA2B;YAC3B,MAAMmC,kBAAkB,MAAMxF,mBAAmBiD,iBAAiB,CAACH,YAAY;gBAC7EI,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,6GAA6G;YAC7G,uDAAuD;YACvDC,OAAOkC,gBAAgB5B,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAEE,sBAAsB,CACrEiB,cAAc3B,KAAK,CAACtD,QAAQ,CAAC8D,SAAS;QAE1C;IACF;IAEArE,SAAS,6BAA6B;QACpC8C,GAAG,8CAA8C;YAC/C,MAAMG,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAAC;gBAACF,0CAAmB;aAAC,EAAE;gBAC/EG,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,oCAAoC;YACpC,MAAMoC,eACJzC,OAAOuB,gBAAgB,CAACmB,SAAS,CAACpF,QAAQ,GAC1C0C,OAAOuB,gBAAgB,CAACmB,SAAS,CAAC7B,UAAU,GAC5Cb,OAAOuB,gBAAgB,CAACmB,SAAS,CAAC5B,GAAG,GACrCd,OAAOuB,gBAAgB,CAACmB,SAAS,CAAC3B,UAAU,GAC5Cf,OAAOuB,gBAAgB,CAACmB,SAAS,CAAC1B,QAAQ,GAC1ChB,OAAOuB,gBAAgB,CAACmB,SAAS,CAACzB,QAAQ,GAC1CjB,OAAOuB,gBAAgB,CAACmB,SAAS,CAACxB,KAAK,GACvClB,OAAOuB,gBAAgB,CAACmB,SAAS,CAACvB,SAAS;YAE7Cb,OAAOmC,cAAc/B,IAAI,CAACV,OAAOuB,gBAAgB,CAACC,QAAQ;QAC5D;QAEA3B,GAAG,yDAAyD;YAC1D,MAAMG,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAAC;gBAACF,0CAAmB;aAAC,EAAE;gBAC/EG,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,MAAMmB,WAAWxB,OAAOuB,gBAAgB,CAACC,QAAQ;YAEjDlB,OAAON,OAAOuB,gBAAgB,CAACI,SAAS,CAACgB,SAAS,EAAEd,WAAW,CAC7DL,WAAW,MACX,CAAC;YAEHlB,OAAON,OAAOuB,gBAAgB,CAACI,SAAS,CAACiB,SAAS,EAAEf,WAAW,CAC7DL,WAAW,MACX,CAAC;YAEHlB,OAAON,OAAOuB,gBAAgB,CAACI,SAAS,CAACkB,SAAS,EAAEhB,WAAW,CAC7DL,WAAW,MACX,CAAC;YAEHlB,OAAON,OAAOuB,gBAAgB,CAACI,SAAS,CAACmB,SAAS,EAAEjB,WAAW,CAC7DL,WAAW,MACX,CAAC;YAEHlB,OAAON,OAAOuB,gBAAgB,CAACI,SAAS,CAACoB,WAAW,EAAElB,WAAW,CAC/DL,WAAW,OACX,CAAC;QAEL;IACF;IAEAzE,SAAS,cAAc;QACrB8C,GAAG,sCAAsC;YACvC,MAAMG,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAAC,EAAE,EAAE;gBAC5DC,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEAC,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAEV,IAAI,CAAC;YAC7CJ,OAAON,OAAOuB,gBAAgB,CAACC,QAAQ,EAAEF,sBAAsB,CAAC;YAChE,wCAAwC;YACxChB,OAAON,OAAOY,KAAK,CAACO,SAAS,CAACC,SAAS,EAAEE,sBAAsB,CAAC;QAClE;QAEAzB,GAAG,+CAA+C;YAChD,MAAMmD,wBAAuC;gBAC3C,GAAGjD,0CAAmB;gBACtBkD,UAAU;gBACVC,MAAM;YACR;YAEA,MAAMlD,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CACvD;gBAAC+C;aAAsB,EACvB;gBACE9C,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAGF,0CAA0C;YAC1CC,OAAON,QAAQO,WAAW;YAC1B,wEAAwE;YACxED,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAE+B,mBAAmB,CAAC;QAC9D;QAEAtD,GAAG,qCAAqC;YACtC,6CAA6C;YAC7C,MAAMuD,eAAgCC,MAAM,KACzCC,IAAI,CAAC,MACLC,GAAG,CAAC,CAACC,GAAGC,QAAW,CAAA;oBAClB,GAAG1D,0CAAmB;oBACtB2D,aAAa,CAAC,GAAG,EAAED,OAAO;oBAC1BR,UAAU;gBACZ,CAAA;YAEF,MAAMjD,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAACmD,cAAc;gBACtElD,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEAC,OAAON,QAAQO,WAAW;YAC1BD,OAAON,OAAOY,KAAK,CAACtD,QAAQ,CAAC8D,SAAS,EAAEC,eAAe,CAAC;YACxDf,OAAON,OAAOuB,gBAAgB,CAACE,UAAU,EAAEJ,eAAe,CAAC;QAC7D;IACF;IAEAtE,SAAS,0BAA0B;QACjC8C,GAAG,wCAAwC;YACzC,MAAMG,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CAAC;gBAACF,0CAAmB;aAAC,EAAE;gBAC/EG,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEAC,OAAON,OAAO2D,YAAY,EAAEC,cAAc,CAACnF;YAC3C6B,OAAON,OAAO6D,OAAO,EAAEtD,WAAW;QACpC;QAEAV,GAAG,oCAAoC;YACrC,MAAMiE,cAAc;gBAClB5D,aAAa;gBACbC,YAAY;gBACZC,cAAc;gBACdC,iBAAiB;YACnB;YAEA,MAAML,SAAS,MAAMhD,mBAAmBiD,iBAAiB,CACvD;gBAACF,0CAAmB;aAAC,EACrB+D;YAGFxD,OAAON,OAAOQ,OAAO,CAACC,IAAI,EAAEC,IAAI,CAACoD,YAAY5D,WAAW;YACxDI,OAAON,OAAOQ,OAAO,CAACG,MAAM,EAAED,IAAI,CAACoD,YAAY3D,UAAU;YACzDG,OAAON,OAAOQ,OAAO,CAACuD,IAAI,EAAErD,IAAI,CAACoD,YAAY1D,YAAY;QAC3D;IACF;AACF"}