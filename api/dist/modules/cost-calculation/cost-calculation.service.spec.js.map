{"version":3,"sources":["../../../src/modules/cost-calculation/cost-calculation.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { CostCalculationService } from './cost-calculation.service';\nimport { MaterialsService } from '../materials/materials.service';\nimport { PricingService } from '../pricing/pricing.service';\nimport { PricingLookupService } from '../../common/utils/pricing-lookup.service';\nimport { ProcessedComponent } from '../../common/interfaces';\nimport {\n  processedDoorComponent,\n  processedCNCComponent,\n  processedPlateComponent,\n  processedComponentSet,\n} from '../../test/fixtures/test-components.fixture';\n\ndescribe('CostCalculationService', () => {\n  let service: CostCalculationService;\n  let materialsService: jest.Mocked<MaterialsService>;\n  let pricingService: jest.Mocked<PricingService>;\n  let pricingLookupService: jest.Mocked<PricingLookupService>;\n\n  beforeEach(async () => {\n    const mockMaterialsService = {\n      calculateMaterialCosts: jest.fn(),\n    };\n\n    const mockPricingService = {\n      calculateFinancialSummary: jest.fn(),\n    };\n\n    const mockPricingLookupService = {\n      getCNCOperationByCode: jest.fn(),\n      getEdgeBandingByCode: jest.fn(),\n      getMaterialByName: jest.fn(),\n      getFittingByCode: jest.fn(),\n      getColorByCode: jest.fn(() => undefined),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        CostCalculationService,\n        {\n          provide: MaterialsService,\n          useValue: mockMaterialsService,\n        },\n        {\n          provide: PricingService,\n          useValue: mockPricingService,\n        },\n        {\n          provide: PricingLookupService,\n          useValue: mockPricingLookupService,\n        },\n      ],\n    }).compile();\n\n    service = module.get<CostCalculationService>(CostCalculationService);\n    materialsService = module.get(MaterialsService);\n    pricingService = module.get(PricingService);\n    pricingLookupService = module.get(PricingLookupService);\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('calculateFullCost', () => {\n    it('should process complete calculation flow', async () => {\n      // Mock all services\n      materialsService.calculateMaterialCosts.mockResolvedValue({\n        category: 'Material',\n        totalCost: 10000000,\n        totalArea: 1.0,\n        totalQuantity: 10,\n        items: [],\n      });\n\n      pricingService.calculateFinancialSummary.mockResolvedValue({\n        subtotal: 15000000,\n        breakdown: {\n          material: 10000000,\n          boreshKari: 0,\n          navarShiar: 1000000,\n          cnc: 500000,\n          fittings: 2000000,\n          painting: 0,\n          woodTools: 500000,\n          plate: 1000000,\n        },\n        overheads: {\n          overhead1: 3750000,\n          overhead2: 600000,\n          overhead3: 300000,\n          overhead4: 300000,\n          contingency: 375000,\n          totalOverheads: 5325000,\n        },\n        totalWithOverheads: 20325000,\n        finalPrice: 24796500,\n        profitAmount: 4471500,\n        profitPercentage: 0.22,\n      });\n\n      pricingLookupService.getCNCOperationByCode.mockResolvedValue({\n        code: 'CNC-1',\n        description: 'CNC Operation',\n        unit: 'عدد',\n        unitPrice: 500000,\n        isActive: true,\n        id: '1',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      pricingLookupService.getEdgeBandingByCode.mockResolvedValue({\n        code: 'EB-1',\n        description: 'Edge Banding',\n        unit: 'متر',\n        unitPrice: 85000,\n        isActive: true,\n        id: '1',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      const result = await service.calculateFullCost(\n        [processedDoorComponent],\n        {\n          projectName: 'Test Project',\n          clientName: 'Test Client',\n          contractDate: '2025-01-01',\n          wastePercentage: 0.15,\n        }\n      );\n\n      expect(result).toBeDefined();\n      expect(result.project.name).toBe('Test Project');\n      expect(result.costs).toBeDefined();\n      expect(result.financialSummary).toBeDefined();\n    });\n  });\n\n  describe('calculateCNCCosts', () => {\n    it('should calculate CNC costs for CNC components', () => {\n      pricingLookupService.getCNCOperationByCode.mockResolvedValue({\n        code: 'CNC-1',\n        description: 'CNC - درب کابینت',\n        unit: 'عدد',\n        unitPrice: 500000,\n        isActive: true,\n        id: '1',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      const components: ProcessedComponent[] = [\n        { ...processedCNCComponent, quantity: 2 },\n      ];\n\n      const result = (service as any).calculateCNCCosts(components);\n\n      expect(result.category).toBe('CNC');\n      expect(result.totalCost).toBeGreaterThan(0);\n      expect(result.items.length).toBeGreaterThan(0);\n    });\n\n    it('should return zero cost for non-CNC components', () => {\n      const components: ProcessedComponent[] = [processedDoorComponent];\n\n      const result = (service as any).calculateCNCCosts(components);\n\n      expect(result.totalCost).toBe(0);\n      expect(result.items).toHaveLength(0);\n    });\n\n    it('should handle different CNC operation types', () => {\n      pricingLookupService.getCNCOperationByCode.mockResolvedValue({\n        code: 'CNC-2',\n        description: 'CNC - Route',\n        unit: 'عدد',\n        unitPrice: 800000,\n        isActive: true,\n        id: '2',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      const components: ProcessedComponent[] = [\n        { ...processedCNCComponent, cleanInstanceType: 'Route', quantity: 1 },\n      ];\n\n      const result = (service as any).calculateCNCCosts(components);\n\n      expect(result.totalCost).toBeGreaterThan(0);\n    });\n  });\n\n  describe('calculateNavarShiarCosts', () => {\n    it('should calculate edge banding costs', () => {\n      pricingLookupService.getEdgeBandingByCode.mockResolvedValue({\n        code: 'EB-1',\n        description: 'نوار کاری',\n        unit: 'متر',\n        unitPrice: 85000,\n        isActive: true,\n        id: '1',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      const components: ProcessedComponent[] = [\n        {\n          ...processedDoorComponent,\n          edge1: 'PVC',\n          edge2: 'PVC',\n          edge3: '',\n          edge4: '',\n          length: 600,\n          width: 400,\n          quantity: 2,\n        },\n      ];\n\n      const result = (service as any).calculateNavarShiarCosts(components);\n\n      expect(result.category).toBe('NavarShiar');\n      expect(result.totalCost).toBeGreaterThan(0);\n      expect(result.items.length).toBeGreaterThan(0);\n    });\n\n    it('should return zero cost for components without edges', () => {\n      const components: ProcessedComponent[] = [\n        {\n          ...processedCNCComponent,\n          edge1: '',\n          edge2: '',\n          edge3: '',\n          edge4: '',\n        },\n      ];\n\n      const result = (service as any).calculateNavarShiarCosts(components);\n\n      expect(result.totalCost).toBe(0);\n    });\n\n    it('should count number of edges correctly', () => {\n      pricingLookupService.getEdgeBandingByCode.mockResolvedValue({\n        code: 'EB-1',\n        description: 'نوار کاری',\n        unit: 'متر',\n        unitPrice: 85000,\n        isActive: true,\n        id: '1',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      const components: ProcessedComponent[] = [\n        {\n          ...processedDoorComponent,\n          edge1: 'PVC',\n          edge2: 'PVC',\n          edge3: 'PVC',\n          edge4: 'PVC',\n          length: 600,\n          width: 400,\n          quantity: 1,\n        },\n      ];\n\n      const result = (service as any).calculateNavarShiarCosts(components);\n\n      // 4 edges, perimeter = 2 * (600 + 400) / 1000 = 2m per edge\n      // Total = 2m * 4 edges * 85,000 = 680,000\n      expect(result.totalCost).toBeGreaterThan(0);\n    });\n  });\n\n  describe('calculateFittingsCosts', () => {\n    it('should calculate fittings for door components', () => {\n      const components: ProcessedComponent[] = [\n        { ...processedDoorComponent, name: 'Cabinet Door', quantity: 2 },\n      ];\n\n      const result = (service as any).calculateFittingsCosts(components);\n\n      expect(result.category).toBe('Fittings');\n      expect(result.totalCost).toBeGreaterThan(0);\n      expect(result.items.length).toBeGreaterThan(0);\n      // Should have hinges\n      expect(result.items.some((item: any) => item.description.includes('لولا'))).toBe(true);\n    });\n\n    it('should calculate fittings for drawer components', () => {\n      const components: ProcessedComponent[] = [\n        {\n          ...processedDoorComponent,\n          name: 'Drawer Front',\n          instanceType: 'Drawer-50cm',\n          width: 500,\n          quantity: 3,\n        },\n      ];\n\n      const result = (service as any).calculateFittingsCosts(components);\n\n      expect(result.totalCost).toBeGreaterThan(0);\n      // Should have both rails and handles\n      expect(result.items.length).toBeGreaterThanOrEqual(2);\n    });\n\n    it('should match drawer rails by size', () => {\n      const components: ProcessedComponent[] = [\n        {\n          ...processedDoorComponent,\n          name: 'Small Drawer',\n          instanceType: 'Drawer-25cm',\n          width: 250,\n          quantity: 1,\n        },\n        {\n          ...processedDoorComponent,\n          name: 'Large Drawer',\n          instanceType: 'Drawer-50cm',\n          width: 500,\n          quantity: 1,\n        },\n      ];\n\n      const result = (service as any).calculateFittingsCosts(components);\n\n      expect(result.totalCost).toBeGreaterThan(0);\n      // Different sizes should have different costs\n      expect(result.items.length).toBeGreaterThan(0);\n    });\n\n    it('should add cabinet handles', () => {\n      const components: ProcessedComponent[] = [\n        {\n          ...processedDoorComponent,\n          name: 'Cabinet Panel',\n          instanceType: 'Cabinet',\n          quantity: 2,\n        },\n      ];\n\n      const result = (service as any).calculateFittingsCosts(components);\n\n      expect(result.items.some((item: any) => item.description.includes('دستکیره'))).toBe(true);\n    });\n  });\n\n  describe('calculatePlateCosts', () => {\n    it('should calculate costs for thin plate materials', () => {\n      pricingLookupService.getMaterialByName.mockResolvedValue({\n        code: 'MAT-3',\n        description: 'ام دی اف 3 میل',\n        unit: 'متر مربع',\n        unitPrice: 3500000,\n        category: 'Panel',\n        persianNames: [],\n        isActive: true,\n        id: '3',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      const components: ProcessedComponent[] = [processedPlateComponent];\n\n      const result = (service as any).calculatePlateCosts(components);\n\n      expect(result.category).toBe('Plate');\n      expect(result.totalCost).toBeGreaterThan(0);\n    });\n\n    it('should return zero cost for thick materials', () => {\n      const components: ProcessedComponent[] = [\n        { ...processedDoorComponent, cutting_thickness: 18 },\n      ];\n\n      const result = (service as any).calculatePlateCosts(components);\n\n      expect(result.totalCost).toBe(0);\n      expect(result.items).toHaveLength(0);\n    });\n  });\n\n  describe('calculateWoodToolsCosts', () => {\n    it('should include base cost', () => {\n      const components: ProcessedComponent[] = [processedDoorComponent];\n\n      const result = (service as any).calculateWoodToolsCosts(components);\n\n      expect(result.category).toBe('WoodTools');\n      expect(result.totalCost).toBeGreaterThanOrEqual(500000); // Base cost\n      expect(result.items.length).toBeGreaterThan(0);\n    });\n\n    it('should add cost for multiple material types', () => {\n      const components: ProcessedComponent[] = [\n        { ...processedDoorComponent, materialType: 'Material A' },\n        { ...processedCNCComponent, materialType: 'Material B' },\n      ];\n\n      const result = (service as any).calculateWoodToolsCosts(components);\n\n      // Base (500k) + 1 additional material (50k) = 550k\n      expect(result.totalCost).toBeGreaterThanOrEqual(550000);\n    });\n\n    it('should add cost for CNC components', () => {\n      const components: ProcessedComponent[] = [\n        processedDoorComponent,\n        processedCNCComponent,\n      ];\n\n      const result = (service as any).calculateWoodToolsCosts(components);\n\n      // Base (500k) + 1 CNC (20k) = 520k\n      expect(result.totalCost).toBeGreaterThanOrEqual(520000);\n    });\n  });\n});\n\n"],"names":["describe","service","materialsService","pricingService","pricingLookupService","beforeEach","mockMaterialsService","calculateMaterialCosts","jest","fn","mockPricingService","calculateFinancialSummary","mockPricingLookupService","getCNCOperationByCode","getEdgeBandingByCode","getMaterialByName","getFittingByCode","getColorByCode","undefined","module","Test","createTestingModule","providers","CostCalculationService","provide","MaterialsService","useValue","PricingService","PricingLookupService","compile","get","it","expect","toBeDefined","mockResolvedValue","category","totalCost","totalArea","totalQuantity","items","subtotal","breakdown","material","boreshKari","navarShiar","cnc","fittings","painting","woodTools","plate","overheads","overhead1","overhead2","overhead3","overhead4","contingency","totalOverheads","totalWithOverheads","finalPrice","profitAmount","profitPercentage","code","description","unit","unitPrice","isActive","id","createdAt","Date","updatedAt","result","calculateFullCost","processedDoorComponent","projectName","clientName","contractDate","wastePercentage","project","name","toBe","costs","financialSummary","components","processedCNCComponent","quantity","calculateCNCCosts","toBeGreaterThan","length","toHaveLength","cleanInstanceType","edge1","edge2","edge3","edge4","width","calculateNavarShiarCosts","calculateFittingsCosts","some","item","includes","instanceType","toBeGreaterThanOrEqual","persianNames","processedPlateComponent","calculatePlateCosts","cutting_thickness","calculateWoodToolsCosts","materialType"],"mappings":"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"}