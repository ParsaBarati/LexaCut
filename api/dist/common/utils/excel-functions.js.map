{"version":3,"sources":["../../../src/common/utils/excel-functions.ts"],"sourcesContent":["/**\n * Excel formula equivalents in TypeScript\n * Provides the same functionality as Excel formulas used in the VBA macros\n */\n\n/**\n * SUM - Sums an array of numbers\n * Excel: =SUM(A7:A30)\n */\nexport function sum(values: number[]): number {\n  return values.reduce((acc, val) => acc + (val || 0), 0);\n}\n\n/**\n * SUMIF - Conditional sum\n * Excel: =SUMIF(range, criteria, sumRange)\n */\nexport function sumIf<T>(\n  data: T[],\n  criteria: (item: T) => boolean,\n  getValue: (item: T) => number\n): number {\n  return data\n    .filter(criteria)\n    .reduce((acc, item) => acc + getValue(item), 0);\n}\n\n/**\n * VLOOKUP - Vertical lookup (exact match, returns undefined if not found)\n * Excel: =VLOOKUP(lookupValue, tableArray, colIndexNum, [rangeLookup])\n * \n * @param lookupValue - Value to search for in first column\n * @param tableArray - 2D array or array of objects to search in\n * @param colIndex - Column index to return (1-based like Excel)\n * @param rangeLookup - If true, approximate match; if false, exact match (default: false)\n */\nexport function vlookup<T extends Record<string, any>>(\n  lookupValue: any,\n  tableArray: T[],\n  colIndex: number,\n  rangeLookup: boolean = false\n): any | undefined {\n  const keys = Object.keys(tableArray[0] || {});\n  const lookupKey = keys[0]; // First column\n  const returnKey = keys[colIndex - 1]; // Column to return (1-based index)\n  \n  if (rangeLookup) {\n    // Approximate match (sorted ascending)\n    let result: T | undefined;\n    for (const row of tableArray) {\n      if (row[lookupKey] <= lookupValue) {\n        result = row;\n      } else {\n        break;\n      }\n    }\n    return result ? result[returnKey] : undefined;\n  } else {\n    // Exact match\n    const row = tableArray.find(item => item[lookupKey] === lookupValue);\n    return row ? row[returnKey] : undefined;\n  }\n}\n\n/**\n * VLOOKUP for simple array-based tables\n * @param lookupValue - Value to search for\n * @param table - Array of arrays [[key1, val1, ...], [key2, val2, ...]]\n * @param colIndex - 1-based column index to return\n */\nexport function vlookupArray(\n  lookupValue: any,\n  table: any[][],\n  colIndex: number\n): any | undefined {\n  const row = table.find(r => r[0] === lookupValue);\n  return row ? row[colIndex - 1] : undefined;\n}\n\n/**\n * ROUNDUP - Rounds a number up\n * Excel: =ROUNDUP(value, decimals)\n */\nexport function roundUp(value: number, decimals: number = 0): number {\n  const multiplier = Math.pow(10, decimals);\n  return Math.ceil(value * multiplier) / multiplier;\n}\n\n/**\n * ROUND - Rounds a number to specified digits\n * Excel: =ROUND(value, decimals)\n */\nexport function round(value: number, decimals: number = 0): number {\n  const multiplier = Math.pow(10, decimals);\n  return Math.round(value * multiplier) / multiplier;\n}\n\n/**\n * CONCATENATE / & - Joins strings\n * Excel: =CONCATENATE(text1, text2, ...) or =A1&B1\n */\nexport function concatenate(...texts: (string | number | null | undefined)[]): string {\n  return texts\n    .map(t => t === null || t === undefined ? '' : String(t))\n    .join('');\n}\n\n/**\n * IF - Conditional logic\n * Excel: =IF(condition, valueIfTrue, valueIfFalse)\n */\nexport function ifCondition<T, F>(\n  condition: boolean,\n  valueIfTrue: T,\n  valueIfFalse: F\n): T | F {\n  return condition ? valueIfTrue : valueIfFalse;\n}\n\n/**\n * TRIM - Removes extra spaces\n * Excel: =TRIM(text)\n */\nexport function trim(text: string): string {\n  return text.replace(/\\s+/g, ' ').trim();\n}\n\n/**\n * REPLACE - Replaces text\n * Excel: Cells.Replace what:=find, Replacement:=replace\n */\nexport function replace(text: string, find: string, replaceWith: string): string {\n  return text.replace(new RegExp(find, 'g'), replaceWith);\n}\n\n/**\n * COUNT - Counts numbers in array\n * Excel: =COUNT(range)\n */\nexport function count(values: any[]): number {\n  return values.filter(v => typeof v === 'number' && !isNaN(v)).length;\n}\n\n/**\n * COUNTIF - Conditional count\n * Excel: =COUNTIF(range, criteria)\n */\nexport function countIf<T>(\n  data: T[],\n  criteria: (item: T) => boolean\n): number {\n  return data.filter(criteria).length;\n}\n\n/**\n * MAX - Returns maximum value\n * Excel: =MAX(range)\n */\nexport function max(values: number[]): number {\n  return values.length > 0 ? Math.max(...values) : 0;\n}\n\n/**\n * MIN - Returns minimum value\n * Excel: =MIN(range)\n */\nexport function min(values: number[]): number {\n  return values.length > 0 ? Math.min(...values) : 0;\n}\n\n/**\n * AVERAGE - Calculates average\n * Excel: =AVERAGE(range)\n */\nexport function average(values: number[]): number {\n  return values.length > 0 ? sum(values) / values.length : 0;\n}\n\n/**\n * Excel-like cell reference parser\n * Converts \"A1\" to {row: 0, col: 0}\n */\nexport function parseCellReference(ref: string): { row: number; col: number } {\n  const match = ref.match(/^([A-Z]+)(\\d+)$/);\n  if (!match) throw new Error(`Invalid cell reference: ${ref}`);\n  \n  const col = match[1].split('').reduce((acc, char) => \n    acc * 26 + char.charCodeAt(0) - 64, 0) - 1;\n  const row = parseInt(match[2]) - 1;\n  \n  return { row, col };\n}\n\n/**\n * Excel-like range parser\n * Converts \"A1:B10\" to array of cell references\n */\nexport function parseRange(range: string): string[] {\n  const [start, end] = range.split(':');\n  const startCell = parseCellReference(start);\n  const endCell = parseCellReference(end);\n  \n  const cells: string[] = [];\n  for (let row = startCell.row; row <= endCell.row; row++) {\n    for (let col = startCell.col; col <= endCell.col; col++) {\n      const colLetter = String.fromCharCode(65 + col);\n      cells.push(`${colLetter}${row + 1}`);\n    }\n  }\n  \n  return cells;\n}\n\n"],"names":["average","concatenate","count","countIf","ifCondition","max","min","parseCellReference","parseRange","replace","round","roundUp","sum","sumIf","trim","vlookup","vlookupArray","values","reduce","acc","val","data","criteria","getValue","filter","item","lookupValue","tableArray","colIndex","rangeLookup","keys","Object","lookupKey","returnKey","result","row","undefined","find","table","r","value","decimals","multiplier","Math","pow","ceil","texts","map","t","String","join","condition","valueIfTrue","valueIfFalse","text","replaceWith","RegExp","v","isNaN","length","ref","match","Error","col","split","char","charCodeAt","parseInt","range","start","end","startCell","endCell","cells","colLetter","fromCharCode","push"],"mappings":"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"}